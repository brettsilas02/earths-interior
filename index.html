<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Geo-Lab</title>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background-color: #0f172a; color: white; 
            font-family: ui-sans-serif, system-ui, sans-serif;
            overflow: hidden; touch-action: none;
        }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .blob { position: absolute; filter: blur(40px); opacity: 0.4; z-index: -1; }
    </style>

    <script>
        const ICONS = {
            Play: '<polygon points="5 3 19 12 5 21 5 3"></polygon>',
            Activity: '<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>',
            Layers: '<polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline>',
            Wind: '<path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/>',
            Database: '<ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>',
            Award: '<circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>',
            CheckCircle: '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>',
            XCircle: '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>',
            Shield: '<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>',
            Lock: '<rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path>',
            BrainCircuit: '<path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.97-1.364"/><path d="M19.97 16.636A4 4 0 0 1 18 18"/>',
            Target: '<circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/>'
        };
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- UTILS ---
        const Icon = ({ name, className }) => {
            const svgString = ICONS[name] || ICONS['Shield'];
            return <div className={className} dangerouslySetInnerHTML={{ __html: svgString }} style={{ display: 'inline-block', verticalAlign: 'middle' }} />;
        };

        const shuffleArray = (array) => {
            const newArr = [...array];
            for (let i = newArr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
            }
            return newArr;
        };

        // --- QUESTION BANK ---
        const QUESTION_BANK = {
            game2: [ 
                { q: "If a seismograph station detects P-waves but no S-waves from an earthquake, what can you infer about the path the waves took?", a: ["They passed through a liquid layer", "They passed through solid granite", "They traveled along the surface only"], correct: "They passed through a liquid layer" },
                { q: "Why do P-waves refract (bend) when they hit the boundary between the Mantle and the Outer Core?", a: ["Density changes drastically", "The temperature drops", "They hit a solid wall"], correct: "Density changes drastically" },
                { q: "Scientists use the 'Shadow Zone' to calculate the size of Earth's core. What property of S-waves creates this shadow?", a: ["They cannot shear through liquids", "They are too fast to be recorded", "They reflect off the crust"], correct: "They cannot shear through liquids" },
                { q: "If the Earth were completely solid rock through and through, what would happen to the seismic waves from an earthquake?", a: ["They would travel in straight lines directly to the other side", "They would stop at the equator", "They would speed up infinitely"], correct: "They would travel in straight lines directly to the other side" },
                { q: "Why is the inner core solid despite being hotter than the liquid outer core?", a: ["Immense pressure prevents melting", "It is made of a different metal", "The magnetic field freezes it"], correct: "Immense pressure prevents melting" }
            ],
            game3: [ 
                { q: "If the Earth's interior completely cooled down, what would happen to tectonic plate movement?", a: ["It would stop completely", "It would speed up", "It would reverse direction"], correct: "It would stop completely" },
                { q: "In a convection current, why does the hot material rise?", a: ["Heat expands volume, lowering density", "Heat increases mass", "Gravity pulls harder on hot things"], correct: "Heat expands volume, lowering density" },
                { q: "The Asthenosphere is described as 'plastic'. What does this mean in a geological context?", a: ["Solid but capable of flowing slowly", "Made of synthetic polymers", "Completely liquid like water"], correct: "Solid but capable of flowing slowly" },
                { q: "What is the primary energy source driving the convection currents in the mantle?", a: ["Radioactive decay and residual heat", "The sun's radiation", "Friction from ocean tides"], correct: "Radioactive decay and residual heat" }
            ],
            game4: [ 
                { q: "Why does oceanic crust subduct (sink) under continental crust during a collision?", a: ["Oceanic (Basalt) is denser than Continental (Granite)", "Oceanic is thinner", "Continental crust is magnetic"], correct: "Oceanic (Basalt) is denser than Continental (Granite)" },
                { q: "You find a rock that has large, visible crystals. What does this tell you about how it formed?", a: ["It cooled slowly underground", "It cooled instantly in water", "It is a sedimentary rock"], correct: "It cooled slowly underground" },
                { q: "Which layer of Earth is thinnest relative to the size of the planet?", a: ["The Crust", "The Mantle", "The Outer Core"], correct: "The Crust" },
                { q: "If you drilled into the sea floor, what rock type would you hit first?", a: ["Basalt", "Granite", "Sandstone"], correct: "Basalt" }
            ]
        };

        // --- COMPONENTS ---

        const LogoHeader = () => (
            <div className="flex flex-col items-center mb-4">
                <div className="w-24 h-24 bg-white/10 rounded-full flex items-center justify-center mb-2 overflow-hidden border-2 border-slate-600 shadow-inner">
                    <div className="text-3xl font-black text-emerald-500">SS</div>
                </div>
                <div className="text-xs font-bold tracking-widest text-slate-500">SILAS SCIENCE DIVISION</div>
            </div>
        );

        const IntroScreen = ({ onStart }) => {
            const [initials, setInitials] = useState('');
            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-slate-950 text-white p-6 font-sans">
                    <div className="max-w-sm w-full bg-slate-900 p-6 rounded-2xl shadow-2xl border border-slate-800 text-center relative overflow-hidden">
                        <LogoHeader />
                        <h1 className="text-3xl font-black mb-2 text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">GEO-LAB INITIATIVE</h1>
                        <div className="mb-6">
                            <label className="block text-left text-xs font-bold text-slate-400 mb-2 uppercase">Enter Agent Initials</label>
                            <input 
                                type="text" maxLength={3} value={initials}
                                onChange={(e) => setInitials(e.target.value.toUpperCase())}
                                className="w-full bg-slate-950 border-2 border-slate-700 text-center text-3xl font-mono p-3 rounded-lg focus:border-emerald-500 focus:outline-none text-white tracking-widest placeholder-slate-700"
                                placeholder="ABC"
                            />
                        </div>
                        <button 
                            onClick={() => initials.length >= 2 && onStart(initials)}
                            disabled={initials.length < 2}
                            className={`w-full py-5 rounded-xl font-black text-xl uppercase tracking-widest transition-all border-none cursor-pointer ${initials.length >= 2 ? 'bg-emerald-500 hover:bg-emerald-400 text-white' : 'bg-slate-800 text-slate-600 cursor-not-allowed'}`}
                        >
                            INITIALIZE TRAINING
                        </button>
                    </div>
                </div>
            );
        };

        const ScoreSummary = ({ score, gameName, onReturn }) => {
            const getRank = (s) => {
                if (s > 800) return { title: "SPECIALIST", color: "text-yellow-400" };
                if (s > 400) return { title: "AGENT", color: "text-emerald-400" };
                return { title: "CADET", color: "text-slate-400" };
            };
            
            const rank = getRank(score);

            return (
                <div className="fixed inset-0 bg-slate-950/95 z-50 flex items-center justify-center p-4 animate-in backdrop-blur-sm">
                    <div className="max-w-md w-full bg-slate-900 border-2 border-slate-700 rounded-2xl shadow-[0_0_50px_rgba(16,185,129,0.1)] p-8 text-center relative overflow-hidden">
                        
                        {/* Background Effect */}
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-emerald-500 via-cyan-500 to-emerald-500"></div>

                        <div className="mb-6">
                            <div className="text-xs font-bold text-slate-500 tracking-widest uppercase mb-1">MISSION DEBRIEF</div>
                            <h2 className="text-2xl font-black text-white uppercase">{gameName}</h2>
                        </div>

                        <div className="py-8 bg-slate-950/50 rounded-xl border border-slate-800 mb-6">
                            <div className="text-slate-400 text-sm font-bold uppercase mb-2">Final Score</div>
                            <div className="text-6xl font-mono font-black text-white tracking-tighter mb-4">{score}</div>
                            
                            <div className="inline-block px-4 py-1 rounded-full bg-slate-800 border border-slate-700">
                                <span className="text-xs text-slate-500 mr-2">RANK ACHIEVED:</span>
                                <span className={`font-black ${rank.color}`}>{rank.title}</span>
                            </div>
                        </div>

                        <p className="text-slate-400 text-sm mb-8 leading-relaxed">
                            Data uploaded to local archives. Analysis complete. Good work, Agent.
                        </p>

                        <button 
                            onClick={onReturn}
                            className="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-emerald-900/50 transition-all active:scale-95 border-none cursor-pointer"
                        >
                            RETURN TO BASE
                        </button>
                    </div>
                </div>
            );
        };

        const QuizGate = ({ gameId, onPass, onCancel }) => {
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [showResult, setShowResult] = useState(false);
            const [selectedAnswer, setSelectedAnswer] = useState(null);

            useEffect(() => {
                const pool = QUESTION_BANK[gameId] || QUESTION_BANK.game2;
                const shuffledQs = [...pool].sort(() => 0.5 - Math.random()).slice(0, 3); // Reduced to 3 for demo
                const processed = shuffledQs.map(q => ({ q: q.q, correctStr: q.correct, a: shuffleArray([...q.a]) }));
                setQuestions(processed);
            }, [gameId]);

            const handleAnswer = (ansStr) => {
                const isCorrect = ansStr === questions[currentIndex].correctStr;
                if (isCorrect) setScore(s => s + 1);
                
                setTimeout(() => {
                    if (currentIndex < questions.length - 1) {
                        setCurrentIndex(c => c + 1);
                    } else {
                        setShowResult(true);
                    }
                }, 400);
            };

            const passed = score >= 2; // Pass if 2 out of 3
            if (questions.length === 0) return null;

            return (
                <div className="fixed inset-0 bg-slate-950 z-50 flex items-center justify-center p-4">
                    <div className="max-w-xl w-full bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl p-6 relative overflow-hidden animate-in">
                        <div className="flex justify-between items-center mb-6 border-b border-slate-800 pb-4">
                            <div className="flex items-center gap-2"><Icon name="Lock" className="w-5 h-5 text-amber-500" /><span className="font-mono text-amber-500 font-bold">SECURITY CLEARANCE</span></div>
                        </div>
                        {!showResult ? (
                            <>
                                <h3 className="text-lg font-bold text-white mb-6 min-h-[80px]">{questions[currentIndex].q}</h3>
                                <div className="space-y-3">
                                    {questions[currentIndex].a.map((ans, i) => (
                                        <button key={i} onClick={() => handleAnswer(ans)} className="w-full p-4 text-left rounded-lg border border-slate-700 bg-slate-800 hover:bg-slate-700 text-slate-300 font-mono text-sm transition-all cursor-pointer">
                                            {ans}
                                        </button>
                                    ))}
                                </div>
                            </>
                        ) : (
                            <div className="text-center py-8">
                                {passed ? (
                                    <>
                                        <Icon name="CheckCircle" className="w-16 h-16 text-emerald-500 mb-4" />
                                        <h2 className="text-2xl font-bold text-white mb-2">ACCESS GRANTED</h2>
                                        <button onClick={onPass} className="w-full py-3 bg-emerald-600 text-white font-bold rounded-lg mt-4 cursor-pointer border-none">PROCEED</button>
                                    </>
                                ) : (
                                    <>
                                        <Icon name="XCircle" className="w-16 h-16 text-red-500 mb-4" />
                                        <h2 className="text-2xl font-bold text-white mb-2">ACCESS DENIED</h2>
                                        <button onClick={onCancel} className="w-full py-3 bg-slate-700 text-white font-bold rounded-lg mt-4 cursor-pointer border-none">RETURN</button>
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const MainMenu = ({ user, onSelectGame }) => {
            return (
                <div className="min-h-screen bg-slate-950 text-white p-4 pb-20 font-sans">
                    <header className="flex justify-between items-center mb-8 pt-4">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-full border border-slate-600 overflow-hidden bg-slate-800 flex items-center justify-center font-bold text-emerald-500">SS</div>
                            <div>
                                <h2 className="text-xl font-black text-emerald-400 tracking-wider">GEO-LAB</h2>
                                <p className="text-xs text-slate-500 font-mono">AGENT ID: {user.initials}</p>
                            </div>
                        </div>
                        {/* LEADERBOARD BUTTON REMOVED */}
                    </header>

                    <div className="grid gap-6 max-w-4xl mx-auto md:grid-cols-3">
                        {/* GAME 1 */}
                        <div onClick={() => onSelectGame('game1')} className={`relative p-6 rounded-2xl border-2 transition-all cursor-pointer group overflow-hidden md:col-span-3 ${user.game1Complete ? 'bg-slate-900 border-emerald-900' : 'bg-gradient-to-br from-indigo-900 to-slate-900 border-indigo-500 shadow-xl shadow-indigo-500/20'}`}>
                            <div className="flex justify-between items-start z-10 relative">
                                <div>
                                    <div className="inline-flex items-center px-2 py-1 rounded bg-indigo-500/20 text-indigo-300 text-xs font-bold mb-2 tracking-wider"><Icon name="Database" className="w-3 h-3 mr-1" /> PHASE 1: INQUIRY</div>
                                    <h3 className="text-2xl font-bold mb-1">Project Deep Dive</h3>
                                    <p className="text-sm text-slate-400">Drill deep and analyze real-time Earth data.</p>
                                </div>
                                {user.game1Complete ? <Icon name="CheckCircle" className="w-8 h-8 text-emerald-500" /> : <Icon name="Play" className="w-8 h-8 text-indigo-400 animate-pulse" />}
                            </div>
                        </div>

                        {/* ARCADE GAMES */}
                        {[
                            { id: 'game2', title: 'Seismic Sorter', sub: 'P vs S Waves', icon: 'Activity', color: 'purple' },
                            { id: 'game3', title: 'Mantle Surfer', sub: 'Convection & Density', icon: 'Wind', color: 'orange' },
                            { id: 'game4', title: 'Crust Collector', sub: 'Mineral Identification', icon: 'Layers', color: 'blue' }
                        ].map(g => (
                            <button key={g.id} disabled={!user.game1Complete} onClick={() => onSelectGame(g.id)} className={`p-5 rounded-xl border-b-4 text-left transition-all h-full relative overflow-hidden group ${!user.game1Complete ? 'bg-slate-900/50 border-slate-800 opacity-50 cursor-not-allowed grayscale' : `bg-slate-800 border-${g.color}-900 hover:border-${g.color}-500 hover:bg-slate-750 active:translate-y-1 active:border-b-0`}`}>
                                <Icon name={g.icon} className={`w-8 h-8 mb-3 ${user.game1Complete ? `text-${g.color}-400` : 'text-slate-600'}`} />
                                <h4 className="font-bold text-lg text-slate-200">{g.title}</h4>
                                <p className="text-xs text-slate-500 mt-1">{g.sub}</p>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- SIMULATED GAME COMPONENT (PLACEHOLDER FOR YOUR REAL GAMES) ---
        const SimpleGame = ({ id, onEnd }) => {
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(10);

            useEffect(() => {
                const timer = setInterval(() => {
                    setTimeLeft(t => {
                        if (t <= 1) {
                            clearInterval(timer);
                            return 0;
                        }
                        return t - 1;
                    });
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                if (timeLeft === 0) onEnd(score);
            }, [timeLeft]);

            return (
                <div className="h-screen bg-slate-900 flex flex-col items-center justify-center p-6 text-center">
                    <h2 className="text-3xl font-bold mb-4 text-emerald-400">SIMULATION: {id.toUpperCase()}</h2>
                    <p className="text-slate-400 mb-8 max-w-md">
                        
                        <br/>
                        Tap the target to generate data points.
                    </p>
                    
                    <div className="text-6xl font-black font-mono mb-8">{timeLeft}s</div>
                    <div className="text-2xl font-mono mb-8 text-amber-400">POINTS: {score}</div>
                    
                    <button 
                        onClick={() => setScore(s => s + 100)}
                        className="w-48 h-48 rounded-full bg-slate-800 border-4 border-slate-600 active:bg-emerald-600 active:border-emerald-400 transition-all shadow-2xl flex items-center justify-center group"
                    >
                        <Icon name="Target" className="w-16 h-16 text-slate-400 group-active:text-white" />
                    </button>
                </div>
            );
        };

        // --- APP CONTROLLER ---
        const App = () => {
            const [view, setView] = useState('intro'); // intro, menu, quiz, game, result
            const [user, setUser] = useState({ initials: '', game1Complete: false });
            const [activeGame, setActiveGame] = useState(null);
            const [lastScore, setLastScore] = useState(0);

            const handleStart = (initials) => {
                setUser({ ...user, initials });
                setView('menu');
            };

            const handleSelectGame = (gameId) => {
                setActiveGame(gameId);
                // If it's game1, go straight to game, otherwise quiz
                if (gameId === 'game1') {
                    setView('game');
                } else {
                    setView('quiz');
                }
            };

            const handleGameEnd = (score) => {
                setLastScore(score);
                if (activeGame === 'game1') {
                    setUser(u => ({ ...u, game1Complete: true }));
                }
                setView('result'); // SHOW SCORE WINDOW
            };

            return (
                <div className="w-full h-full">
                    {view === 'intro' && <IntroScreen onStart={handleStart} />}
                    
                    {view === 'menu' && <MainMenu user={user} onSelectGame={handleSelectGame} />}
                    
                    {view === 'quiz' && (
                        <QuizGate 
                            gameId={activeGame} 
                            onPass={() => setView('game')} 
                            onCancel={() => setView('menu')} 
                        />
                    )}
                    
                    {view === 'game' && (
                        // Replace SimpleGame with your actual Game Components (Game1, Game2, etc)
                        <SimpleGame id={activeGame} onEnd={handleGameEnd} />
                    )}

                    {view === 'result' && (
                        <ScoreSummary 
                            score={lastScore} 
                            gameName={activeGame} 
                            onReturn={() => setView('menu')} 
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
